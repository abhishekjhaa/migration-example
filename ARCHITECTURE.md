# üèóÔ∏è **System Architecture**

## **High-Level Architecture Diagram**

```mermaid
graph TB
    subgraph "Client Layer"
        CLIENT[Client Applications<br/>Web, Mobile, API]
    end

    subgraph "Services Layer"
        ORDER_SVC[Order Service<br/>Port 3001]
        INVOICE_SVC[Invoice Service<br/>Port 3004]
    end

    subgraph "Caching Layer"
        CACHE[Redis Cache<br/>Port 6379]
    end

    subgraph "Data Layer"
        DATABASE[(PostgreSQL<br/>Port 5433)]
    end

    %% Simple connections
    CLIENT --> ORDER_SVC
    CLIENT --> INVOICE_SVC
    ORDER_SVC --> INVOICE_SVC
    
    ORDER_SVC --> CACHE
    INVOICE_SVC --> CACHE
    
    ORDER_SVC --> DATABASE
    INVOICE_SVC --> DATABASE

    %% Styling
    classDef service fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef database fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef cache fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef client fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px

    class ORDER_SVC,INVOICE_SVC service
    class DATABASE database
    class CACHE cache
    class CLIENT client
```

## **Legacy to Modern Services Migration Architecture**

```mermaid
graph TB
    subgraph "Legacy System"
        LEGACY_APP[Legacy Monolithic Application<br/>SQL Server/Oracle]
        LEGACY_DB[(Legacy Database<br/>SQL Server/Oracle)]
        LEGACY_API[Legacy API Endpoints]
    end

    subgraph "Migration Layer"
        MIGRATION_SVC[Migration Service<br/>Port 3000]
        RECONCILIATION[Data Reconciliation Service]
        SHADOW_COMPARISON[Shadow Comparison Service]
    end

    subgraph "Modern Microservices"
        ORDER_SVC[Order Service<br/>Port 3001]
        INVOICE_SVC[Invoice Service<br/>Port 3004]
        CACHE[Redis Cache<br/>Port 6379]
        MODERN_DB[(Modern PostgreSQL<br/>Port 5433)]
    end

    subgraph "Client Layer"
        CLIENTS[Client Applications]
    end

    %% Legacy system connections
    LEGACY_APP --> LEGACY_DB
    LEGACY_APP --> LEGACY_API

    %% Migration process
    LEGACY_DB -.->|Data Extraction| MIGRATION_SVC
    MIGRATION_SVC -->|Data Transformation| MODERN_DB
    MIGRATION_SVC -->|Data Validation| RECONCILIATION
    
    %% Reconciliation process
    RECONCILIATION -.->|Compare Data| LEGACY_DB
    RECONCILIATION -->|Validate Consistency| MODERN_DB
    RECONCILIATION -->|Generate Reports| SHADOW_COMPARISON

    %% Modern services communication
    ORDER_SVC --> MODERN_DB
    INVOICE_SVC --> MODERN_DB
    ORDER_SVC --> CACHE
    INVOICE_SVC --> CACHE
    ORDER_SVC --> INVOICE_SVC

    %% Client routing (dual mode)
    CLIENTS -->|Legacy Mode| LEGACY_API
    CLIENTS -->|Modern Mode| ORDER_SVC
    CLIENTS -->|Modern Mode| INVOICE_SVC

    %% Styling
    classDef legacy fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef migration fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef modern fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef client fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef database fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef cache fill:#fff8e1,stroke:#f57f17,stroke-width:2px

    class LEGACY_APP,LEGACY_DB,LEGACY_API legacy
    class MIGRATION_SVC,RECONCILIATION,SHADOW_COMPARISON migration
    class ORDER_SVC,INVOICE_SVC modern
    class CLIENTS client
    class MODERN_DB,LEGACY_DB database
    class CACHE cache
```

## **Migration Communication Patterns**

```mermaid
sequenceDiagram
    participant L as Legacy System
    participant M as Migration Service
    participant R as Reconciliation Service
    participant N as Modern Services
    participant C as Cache
    participant D as Modern DB

    Note over L,M: Phase 1: Data Migration
    L->>M: Extract legacy data
    M->>D: Transform and load data
    M->>R: Trigger reconciliation

    Note over R,D: Phase 2: Data Validation
    R->>L: Query legacy data
    R->>D: Query modern data
    R->>R: Compare and validate
    R->>M: Report discrepancies

    Note over N,C: Phase 3: Modern Services
    N->>C: Cache frequently accessed data
    N->>D: Query modern database
    C-->>N: Return cached data
    D-->>N: Return fresh data

    Note over L,N: Phase 4: Dual Operation
    L->>L: Handle legacy requests
    N->>N: Handle modern requests
    N->>R: Periodic reconciliation
```

## **Detailed Component Architecture**

### **1. API Gateway Layer**
- **AWS Application Load Balancer (ALB)**
  - Routes traffic to microservices
  - Health checks and auto-scaling
  - SSL termination
  - Path-based routing

- **AWS API Gateway**
  - RESTful API management
  - Rate limiting and throttling
  - API versioning
  - Request/response transformation

### **2. Microservices Layer**

#### **Order Service (Port 3001)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Order Service             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Controllers                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ OrdersController               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ CustomersController            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Services                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ OrdersService                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ CustomersService               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Repositories                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ OrderRepository                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ CustomerRepository             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  External Dependencies              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Prisma ORM                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Redis Cache                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ PostgreSQL                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Invoice Service (Port 3004)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Invoice Service            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Controllers                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ InvoicesController             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Services                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ InvoicesService                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ OrderApiService (External)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Repositories                       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ InvoiceRepository              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  External Dependencies              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Prisma ORM                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Redis Cache                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ PostgreSQL                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Order Service API              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Migration Service (Port 3000)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Migration Service           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Controllers                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ MigrationController            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ ReconciliationController       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Services                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ MigrationService               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ DataReconciliationService      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ ReconciliationService          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  External Dependencies              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Prisma ORM                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Legacy Database Connector      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ PostgreSQL                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **3. Caching Architecture**

#### **Multi-Layer Caching Strategy**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Client Request            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         API Gateway                 ‚îÇ
‚îÇ      (Response Caching)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Microservice                 ‚îÇ
‚îÇ    (@Cacheable Decorator)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                   ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Redis  ‚îÇ         ‚îÇMemory  ‚îÇ
‚îÇ Cache  ‚îÇ         ‚îÇCache   ‚îÇ
‚îÇ(Primary‚îÇ         ‚îÇ(Fallback‚îÇ
‚îÇ Layer) ‚îÇ         ‚îÇ Layer) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        PostgreSQL                   ‚îÇ
‚îÇ      (Database Layer)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **4. Data Flow Architecture**

#### **Request Flow**
```mermaid
sequenceDiagram
    participant Client
    participant ALB
    participant Service
    participant Cache
    participant DB

    Client->>ALB: HTTP Request
    ALB->>Service: Route to Service
    Service->>Cache: Check Cache
    alt Cache Hit
        Cache-->>Service: Return Cached Data
        Service-->>ALB: Response
        ALB-->>Client: HTTP Response
    else Cache Miss
        Service->>DB: Database Query
        DB-->>Service: Query Results
        Service->>Cache: Store in Cache
        Service-->>ALB: Response
        ALB-->>Client: HTTP Response
    end
```

#### **Migration Flow**
```mermaid
sequenceDiagram
    participant Migration
    participant LegacyDB
    participant ModernDB
    participant Reconciliation

    Migration->>LegacyDB: Extract Data
    LegacyDB-->>Migration: Raw Data
    Migration->>Migration: Transform Data
    Migration->>ModernDB: Insert Transformed Data
    ModernDB-->>Migration: Confirmation
    Migration->>Reconciliation: Validate Migration
    Reconciliation->>LegacyDB: Compare Data
    Reconciliation->>ModernDB: Compare Data
    Reconciliation-->>Migration: Validation Report
```

## **Technology Stack**

### **Backend Services**
- **Framework**: NestJS (Node.js)
- **Language**: TypeScript
- **ORM**: Prisma
- **Database**: PostgreSQL 15
- **Cache**: Redis 7
- **API Documentation**: Swagger/OpenAPI

### **Infrastructure**
- **Containerization**: Docker
- **Orchestration**: Amazon ECS
- **Load Balancer**: AWS Application Load Balancer
- **API Gateway**: AWS API Gateway
- **Infrastructure as Code**: AWS CloudFormation
- **Container Registry**: Amazon ECR

### **Monitoring & Observability**
- **Logging**: AWS CloudWatch Logs
- **Metrics**: AWS CloudWatch Metrics
- **Tracing**: AWS X-Ray
- **Health Checks**: Custom health endpoints

### **Development & Deployment**
- **Version Control**: Git
- **CI/CD**: GitHub Actions (planned)
- **Local Development**: Docker Compose
- **Testing**: Jest, Supertest
- **Code Quality**: ESLint, Prettier

## **Security Architecture**

### **Network Security**
- **VPC**: Isolated network environment
- **Security Groups**: Firewall rules for service communication
- **Private Subnets**: Database and cache in private networks
- **NAT Gateway**: Outbound internet access for private resources

### **Application Security**
- **HTTPS**: TLS encryption for all communications
- **API Authentication**: JWT tokens (planned)
- **Input Validation**: Class-validator decorators
- **SQL Injection Prevention**: Prisma ORM parameterized queries

### **Data Security**
- **Encryption at Rest**: AWS RDS encryption
- **Encryption in Transit**: TLS for all connections
- **Secrets Management**: AWS Secrets Manager
- **Database Access**: IAM roles and policies

## **Scalability Architecture**

### **Horizontal Scaling**
- **Auto Scaling Groups**: ECS service auto-scaling
- **Load Distribution**: ALB with multiple targets
- **Stateless Services**: No session affinity required
- **Database Connection Pooling**: Prisma connection management

### **Vertical Scaling**
- **Resource Allocation**: CPU and memory optimization
- **Container Sizing**: Right-sized ECS task definitions
- **Database Scaling**: RDS instance scaling options

### **Performance Optimization**
- **Caching Strategy**: Multi-layer caching with Redis
- **Database Indexing**: Optimized Prisma queries
- **CDN Integration**: CloudFront for static assets (planned)
- **Connection Pooling**: Efficient database connections

## **Deployment Architecture**

### **Environment Separation**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Production                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   ECS   ‚îÇ  ‚îÇ   RDS   ‚îÇ          ‚îÇ
‚îÇ  ‚îÇServices ‚îÇ  ‚îÇPostgreSQL‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            Staging                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   ECS   ‚îÇ  ‚îÇ   RDS   ‚îÇ          ‚îÇ
‚îÇ  ‚îÇServices ‚îÇ  ‚îÇPostgreSQL‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Development               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ Docker  ‚îÇ  ‚îÇ Docker  ‚îÇ          ‚îÇ
‚îÇ  ‚îÇCompose  ‚îÇ  ‚îÇPostgreSQL‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **CI/CD Pipeline** (Planned)
```mermaid
graph LR
    A[Git Push] --> B[GitHub Actions]
    B --> C[Build & Test]
    C --> D[Build Docker Images]
    D --> E[Push to ECR]
    E --> F[Deploy to Staging]
    F --> G[Integration Tests]
    G --> H[Deploy to Production]
    H --> I[Health Checks]
```

This architecture provides a robust, scalable, and maintainable foundation for the modernized Order Management System with clear separation of concerns, comprehensive caching, and cloud-native deployment capabilities.
